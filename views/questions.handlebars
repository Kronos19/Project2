<div class="container">
  <div class="row">
    <div class="col-md-4">
      <p>This is quiz <span id="quiz-id">{{quiz}}</span></p>
      <p>
        This is where we will display information 
        about your stats for the current session
      </p>
    </div>
    <div class="col-md-6">
      <div id="question-container">
        <p>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Similique, cupiditate ullam facere dolor quos porro molestiae, nemo consectetur nesciunt doloribus vel fugiat perspiciatis tempore! Facere laboriosam placeat culpa minus amet! lorem</p>
      </div>
      <div id="code-block-container">
        <code>
          var turkey = 52; &#10
          function foo(bar) {
            return bar * 2;
          }
          console.log(foo(turkey)); // 104
        </code>
      </div>
      <hr>
      <div id="answers-container">
        <p id="choice1">CHOICE1 Lorem ipsum dolor sit, amet consectetur adipisicing elit. Sapiente beatae praesentium, rem neque similique enim error vero, soluta consequuntur architecto ab maiores. Voluptates, laboriosam harum rem sequi quod obcaecati minus.</p>
        <p id="choice2">CHOICE 2 hahahahahahahaha</p>
        <p id="choice3">CHOICE 3</p>
        <p id="choice4">CHOICE 4 Lorem ipsum dolor sit amet, consectetur adipisicing elit. Possimus natus, maxime ipsum quae officia repellat id soluta dolores fuga est similique reprehenderit nihil necessitatibus quas commodi quo ullam perspiciatis illo?</p>
      </div>
      <button class="btn btn-danger" id="sub-btn">Submit your answer!</button>
    </div>
    <div class="col-md-2"></div>

  </div>
</div>
<script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
 ></script>
<script>
  // TODO: need error handling for incorrect quizId
  const quizId = document.querySelector("#quiz-id").textContent;
  const questionDisplay = document.querySelector("#question-container");
  const codeBlockDisplay = document.querySelector("#code-block-container");
  const answerDisplay = document.querySelector("#answers-container");
  let questIndex = 0;
  let positionOfCorrectAnswer;
  let quests; // dont think ill need this
  let dataReady = false;
  
  function getQuizQuestions(quizId) {
    $.ajax({
      type: "GET",
      url: "../api/quiz/" + quizId
    }).then((data)=>{
      console.log(data);
      quests = data; // ??? dont think ill need this
      displayNew(data, questIndex);
    }).catch((err)=>{
      console.log(err);
    });
  }

  // main display functions
  function displayNew(quests, index){
    clearChildren(questionDisplay);
    clearChildren(codeBlockDisplay);
    clearChildren(answerDisplay);
    writeQuestionToPage(quests[index]);
    writeAnswersToPage(quests[index]);
    if (quests[index].codeBlock) writeCodeBlockToPage(quests[index]);
    questIndex++;
  }

  function writeQuestionToPage(q) {
    const paragraph = document.createElement("p");
    paragraph.textContent = q.question;
    questionDisplay.appendChild(paragraph);
  }

  function writeAnswersToPage(q) {
    // pick random spot for correct answer
    positionOfCorrectAnswer = Math.floor(Math.random() * 4);
    const ansArr = [q.correct, q.incorrect1, q.incorrect2, q.incorrect3];
    swapElements(ansArr, 0, positionOfCorrectAnswer);
    for (let i = 0; i < ansArr.length; i++) {
      let answerChoice = document.createElement("p");
      answerChoice.value = i;
      answerChoice.textContent = ansArr[i];
      answerChoice.classList.add("answer-choice"); // to add css later
      answerChoice.addEventListener("click",(e)=>{
        console.log(e.target.value);
        console.log(e.target.value == positionOfCorrectAnswer);
        handleAnswer(e.target.value);
      })
      answerDisplay.appendChild(answerChoice);
    }
  }

  function handleAnswer(choice){
    console.log("choice was: ", choice);
    displayNew(quests, questIndex);
  }

  // utility functions
  function clearChildren(parent) {
    while(parent.firstChild) {
      parent.removeChild(parent.firstChild);
    }
  }

  function swapElements(arr, i, j){
    let tmp = arr[i];
    arr[i] = arr[j];
    arr[j] = tmp;
  }

  getQuizQuestions(quizId);
  


</script>